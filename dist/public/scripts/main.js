"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function initMap(){bps.dataService.getData().done(function(t){drawMap(t)})}function getMeters(t){return 1609.344*t}function drawMap(t){var e={lat:42.33894360169467,lng:-71.1169069898682},n=new google.maps.Map(document.getElementById("map"),{zoom:13,center:e});google.maps.Circle.prototype.contains=function(t){return this.getBounds().contains(t)&&google.maps.geometry.spherical.computeDistanceBetween(this.getCenter(),t)<=this.getRadius()};var r=new App(t,n);window.app=r,r.filter()}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),bps=bps||{},DataService=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"getData",value:function(){return $.get("../data/boston-main-assets.json").then(this.normalizeData)}},{key:"normalizeData",value:function(t){function e(t){return!t||/^\s*$/.test(t)}return t.assets.reduce(function(t,n){if(!e(n.MatchLatit)){var r={address:n.Address_Te,lat:n.MatchLatit,lng:n.MatchLongi,organization:n.Organizati,website:n.Website,phone:n.Phone_Numb,fax:n.Fax,email:n.Email,languages:n.Languages,information:n.Informatio,category:n.Category};t.push(r)}return t},[])}}]),t}();bps.dataService=new DataService;var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),App=function(){function t(e,n){_classCallCheck(this,t),this.assets=e,this.map=n,this.parse(this.assets),this.currentMarkers=[],this.currentAssets=[],this.setupDom()}return _createClass(t,[{key:"setupDom",value:function(){var t=this;this.autocomplete=new google.maps.places.Autocomplete(document.getElementById("places-input")),this.autocomplete.bindTo("bounds",this.map),this.autocomplete.addListener("place_changed",function(){t.handlePlaceInput()}),$("#clear-address").click(function(){t.clearCurrentPlace()}),this.categories.forEach(function(t){$("#category-dropdown").append("<option>"+t+"</option>")}),$("#category-dropdown").change(function(){t.filter()}),$("#radius").change(function(){t.filter()}),$("#printout-button").click(function(){t.printCurrent()})}},{key:"handlePlaceInput",value:function(){this.currentPlace=this.autocomplete.getPlace(),$("#current-address").html(this.currentPlace.formatted_address),$("#places-input").val(""),$("#clear-address").show(),this.filter()}},{key:"clearCurrentPlace",value:function(){this.currentPlace=null,$("#current-address").html("None"),$("#clear-address").hide(),this.filter()}},{key:"parse",value:function(){this.categories=[].concat(_toConsumableArray(new Set(this.assets.map(function(t){return t.category})))),window.foo=this.categories}},{key:"filter",value:function(){this.clearAssets();var t=this.filterByCategory(this.assets,$("#category-dropdown :selected").text());this.currentAssets=this.filterByLocation(t,this.autocomplete.getPlace(),$("#radius").val()),this.plotAssets()}},{key:"filterByCategory",value:function(t,e){return this.currentCategory===e?t:"All"===e?t:t.filter(function(t){return t.category===e})}},{key:"drawCircle",value:function(t,e){return new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:this.map,center:t,radius:e})}},{key:"filterByLocation",value:function(t){if(!this.currentPlace)return t;var e=new google.maps.LatLng(this.currentPlace.geometry.location.lat(),this.currentPlace.geometry.location.lng()),n=getMeters($("#radius").val());return this.currentCircle=this.drawCircle(e,n),t.filter(function(t){var r=new google.maps.LatLng(t.lat,t.lng);return google.maps.geometry.spherical.computeDistanceBetween(e,r)<n})}},{key:"plotAssets",value:function(){var t=this;this.currentAssets.forEach(function(e){var n=new google.maps.Marker({position:{lat:e.lat,lng:e.lng},map:t.map}),r=new google.maps.InfoWindow({content:t.getInfoWindowDom(e,!1)});n.addListener("click",function(){t.currentInfoWindow&&t.currentInfoWindow.close(),r.open(t.map,n),t.currentInfoWindow=r}),t.currentMarkers.push(n)})}},{key:"clearAssets",value:function(){this.currentMarkers.forEach(function(t){t.setMap(null)}),this.currentCircle&&this.currentCircle.setMap(null),this.currentAssets=[],this.currentMarkers=[]}},{key:"getInfoWindowDom",value:function(t,e){return e?"":'\n        <div class="info-window">\n          <h3>'+t.organization+'</h3>\n          <table class="table">\n            <tr><td>Address </td><td> '+t.address+"</td></tr>\n            <tr><td>Website </td><td> "+t.website+"</td></tr>\n            <tr><td>Phone </td><td> "+t.phone+"</td></tr>\n            <tr><td>Fax\t</td><td> "+t.fax+"</td></tr>\n            <tr><td>Email\t</td><td> "+t.email+"</td></tr>\n            <tr><td>Languages\t</td><td> "+t.languages+"</td></tr>\n            <tr><td>Information </td><td> "+t.information+"</td></tr>\n            <tr><td>Category </td><td> "+t.category+"</td></tr>\n          </table>\n        </div>\n      "}},{key:"printCurrent",value:function(){var t=this,e="";this.currentAssets.forEach(function(n){e+=t.getInfoWindowDom(n,!1)},this);var n=window.open("","");n.document.write(e),n.document.close()}}]),t}();